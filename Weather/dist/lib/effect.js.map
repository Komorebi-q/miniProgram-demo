{"version":3,"sources":["lib/effect.js"],"names":["STATUS_STOP","STATUS_RUNNING","Rain","ctx","width","height","options","timer","w","h","_opts","status","_init","amount","speedFactor","speed","particles","i","push","x","Math","random","y","l","xs","ys","color","ps","clearRect","forEach","beginPath","moveTo","p","lineTo","setStrokeStyle","stroke","draw","_update","setInterval","_draw","length","s","clearInterval","stop","Snow","opts","colors","radius","ox","r","floor","rs","arc","PI","setFillStyle","fill","closePath","v","map","cos"],"mappings":"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","file":"effect.js","sourcesContent":["const STATUS_STOP = 'stop';\nconst STATUS_RUNNING = 'running';\nexport class Rain {\n  // particles;\n  // timer;\n  // ctx;\n  // w;\n  // h;\n  // _opts;\n  // status;\n  constructor (ctx, width, height, options) {\n    this.timer = null;\n    this.ctx= ctx;\n    this.w = width;\n    this.h = height;\n    this._opts = options;\n    this.status = STATUS_STOP;\n    this._init();\n  }\n  _init() {\n    let {\n      amount= 100,\n      speedFactor= 0.03,\n    } = this._opts;\n    let w = this.w;\n    let h = this.h;\n    let speed = speedFactor * h;\n    this.particles = [];\n    for (let i = 0; i < amount; i++) {\n      this.particles.push({\n        x: Math.random() * w,\n        y: Math.random() * h,\n        l: 2 * Math.random(),\n        xs: -1,\n        ys: 10 * Math.random() + speed,\n        color: 'rgba(255, 255, 255, 0.1)'\n      });\n    }\n  }\n  _draw() {\n    let ps = this.particles;\n    let ctx = this.ctx;\n    ctx.clearRect(0, 0 , this.w, this.h);\n    ps.forEach(p => {\n      ctx.beginPath();\n      ctx.moveTo(p.x, p.y);\n      ctx.lineTo(p.x + p.l * p.xs, p.y + p.l * p.ys);\n      ctx.setStrokeStyle(p.color);\n      ctx.stroke();\n    });\n    ctx.draw();\n    return this._update();\n  }\n  run() {\n    if (this.status !== STATUS_RUNNING) {\n      this.status = STATUS_RUNNING;\n      this.timer = setInterval(() => {\n        this._draw();\n      }, 30);\n    }\n    return this;\n  }\n  _update() {\n    const {\n      w,\n      h\n    } = this;\n    for (let ps = this.particles, i = 0; i < ps.length; i++) {\n      // 开始下一个周期的位置计算\n      let s = ps[i]\n      s.x += s.xs\n      s.y += s.ys\n      // 超出范围，重新回收，重复利用\n      if (s.x > w || s.y > h) {\n        s.x = Math.random() * w\n        s.y = -10\n      }\n    }\n  }\n  stop() {\n    this.status = STATUS_STOP;\n    clearInterval(this.timer);\n    return this;\n  }\n  clear() {\n    this.stop();\n    this.ctx.clearRect(0, 0, this.w, this.h);\n    this.ctx.draw();\n    return this;\n  }\n};\nexport class Snow {\n  // particles;\n  // timer;\n  // w;\n  // h;\n  // ctx;\n  // _tops;\n  // status;\n  constructor(ctx, w, h, opts) {\n    this.timer = null;\n    this.ctx= ctx;\n    this.w = w;\n    this.h = h;\n    this._opts = opts;\n    this.status = STATUS_STOP;\n    this._init();\n  }\n  _init() {\n    let {\n      w, \n      h,\n      _opts,\n      particles\n    } = this;\n    const {\n      amount= 100,\n      colors= ['#ccc', '#eee', '#fff', '#ddd'],\n      speedFactor= 0.3,\n      radius= 2\n    } = _opts;\n    const speed = speedFactor * 0.15 * h;\n    this.particles = [];\n    for (let i = 0; i < amount; i++) {\n      let x = Math.random() * w;\n      let y = Math.random() * h;\n      this.particles.push({\n        x,\n        y,\n        ox: x,\n        ys: Math.random() + speed,\n        r: Math.floor(Math.random() * (radius + 0.5) + 0.5),\n        color: colors[Math.floor(Math.random() * colors.length)],\n        rs: Math.random() * 80\n      });\n    }\n  }\n  run() {\n    if (this.status !== STATUS_RUNNING) {\n      this.status = STATUS_RUNNING;\n      this.timer = setInterval(() => {\n        this._draw();\n      }, 30);\n    }\n    return this;\n  }\n  _draw() {\n    let {\n      particles,\n      ctx\n    } = this;\n    ctx.clearRect(0, 0, this.w, this.h)\n    particles.forEach(p => {\n      let {\n        x,\n        y,\n        r,\n        color\n      } = p;\n      ctx.beginPath();\n      ctx.arc(x, y, r, Math.PI * 2, false);\n      ctx.setFillStyle(color);\n      ctx.fill();\n      ctx.closePath();\n    });\n    ctx.draw();\n    this._update()\n  }\n  _update() {\n    let {\n      w,\n      h, \n      particles\n    } = this\n    const v = this._opts.speedFactor / 10\n    particles = particles.map(p => {\n      let {\n        ox,\n        ys\n      } = p;\n      p.rs += v;\n      p.x = ox + Math.cos(p.rs) * w / 2;\n      p.y += ys;\n      if (p.x > w || p.y > h) {\n        p.x = Math.random() * w;\n        p.y = -10;\n      }\n      return p;\n    });\n  }\n  stop() {\n    this.status = STATUS_STOP;\n    clearInterval(this.timer);\n    return this;\n  }\n  clear() {\n    this.stop();\n    this.ctx.clearRect(0, 0, this.w, this.h);\n    this.ctx.draw();\n    return this;\n  }\n};\n"]}